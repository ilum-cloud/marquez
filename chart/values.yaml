# SPDX-License-Identifier: Apache-2.0

## Name override for the chart
##
nameOverride: ""

## Full name override for the chart
##
fullnameOverride: ""

## Additional labels to all the deployed resources
##
commonLabels: {}
## - name: app.kubernetes.io/part-of
##   value: "ilum-data-stack"

## Additional annotations to all the deployed resources
##
commonAnnotations: {}
## - name: support-contact
##   value: "ops-team"

## ServiceAccount configuration
##
serviceAccount:
  ## Specifies whether a ServiceAccount should be created
  ##
  create: true
  ## Annotations to add to the ServiceAccount
  ##
  annotations: {}
  ## The name of the ServiceAccount to use.
  ## If not set and create is true, a name is generated using the fullname template
  ##
  name: ""

## Marquez Core Configuration
##
marquez:
  ## Number of desired replicas
  ##
  replicaCount: 1

  ## Marquez image version
  ## ref: https://hub.docker.com/r/ilum/marquez/tags/
  ##
  image:
    registry: docker.io
    repository: ilum/marquez
    tag: 0.53.1
    pullPolicy: IfNotPresent

  ## Image pull secrets
  ##
  imagePullSecrets: []

  ## Name of the existing secret containing credentials for the Marquez installation.
  ## When this is specified, it will take precedence over the values configured in the 'db' section.
  ## The secret must contain the key 'marquez-db-password'.
  ##
  existingSecretName: ""

  ## Pod Disruption Budget configuration
  ##
  pdb:
    create: false
    minAvailable: 1
    # maxUnavailable: 1

  ## Pod Security Context
  ## ref: https://kubernetes.io/docs/tasks/configure-pod-container/security-context/
  ##
  podSecurityContext: {}
    # fsGroup: 2000

  ## Container Security Context
  ##
  securityContext: {}
    # capabilities:
    #   drop:
    #   - ALL
    # readOnlyRootFilesystem: true
    # runAsNonRoot: true
    # runAsUser: 1000

  ## Extra containers to add to the Marquez pod
  ##
  extraContainers: []

  ## Postgres database settings where Marquez data will persist
  ## Only used if postgresql.enabled is false
  ##
  db:
    # Used for init container to wait for DB
    image: "bitnamilegacy/postgresql:16"
    host: "ilum-postgresql-0.ilum-postgresql-hl"
    port: 5432
    name: marquez
    user: ilum
    password: "CHANGEMEPLEASE"

  ## Database Retention Policy
  ##
  dbRetention:
    enabled: false
    # Apply retention policy at a frequency of every 'X' minutes (default: 15)
    frequencyMins: 15
    # Maximum number of rows deleted per batch (default: 1000)
    numberOfRowsPerBatch: 1000
    # Maximum retention days (default: 7)
    retentionDays: 7

  ## Indicates if Flyway database migration will execute upon deployment
  ##
  migrateOnStartup: true
  
  ## Marquez hostname and ports
  ##
  hostname: localhost
  port: 5000
  adminPort: 5001

  ## Service configuration for Marquez Core
  ##
  service:
    type: "ClusterIP"
    port: 9555
    nodePort: ""
    clusterIP: ""
    loadBalancerIP: ""
    annotations: { }

  ## Resource requests and limits
  ## ref: http://kubernetes.io/docs/user-guide/compute-resources/
  ##
  resources:
    limits: {}
    requests: {}

  ## Liveness Probe configuration
  ##
  livenessProbe:
    failureThreshold: 3
    httpGet:
      path: /healthcheck
      port: http-admin
      scheme: HTTP
    initialDelaySeconds: 60
    periodSeconds: 10
    successThreshold: 1
    timeoutSeconds: 1

  ## Readiness Probe configuration
  ##
  readinessProbe:
    failureThreshold: 3
    httpGet:
      path: /healthcheck
      port: http-admin
      scheme: HTTP
    initialDelaySeconds: 60
    periodSeconds: 10
    successThreshold: 1
    timeoutSeconds: 1

## Marquez Web UI Configuration
##
web:
  ## Enables creation of the web UI
  ##
  enabled: true

  ## Marquez Web image version
  ##
  image:
    registry: docker.io
    repository: ilum/marquez-web
    tag: 0.53.1
    pullPolicy: IfNotPresent
  
  ## Image pull secrets
  ##
  imagePullSecrets: []

  ## Pod Disruption Budget configuration
  ##
  pdb:
    create: false
    minAvailable: 1
    # maxUnavailable: 1

  ## Pod Security Context
  ##
  podSecurityContext: {}
    # fsGroup: 2000

  ## Container Security Context
  ##
  securityContext: {}
    # capabilities:
    #   drop:
    #   - ALL
    # readOnlyRootFilesystem: true
    # runAsNonRoot: true
    # runAsUser: 1000

  ## Service configuration for Marquez Web
  ##
  service:
    type: "ClusterIP"
    port: 9444
    nodePort: ""
    clusterIP: ""
    loadBalancerIP: ""
    annotations: { }

  ## Resource requests and limits
  ##
  resources:
    limits: {}
    requests: {}

## Affinity for pod assignment
## Ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity
##
affinity:
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
      - matchExpressions:
        - key: kubernetes.io/arch
          operator: In
          values:
          - amd64
          - arm64

## Tolerations for pod assignment
## Ref: https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/
##
tolerations: []

## Node labels for pod assignment
## Ref: https://kubernetes.io/docs/user-guide/node-selection/
##
nodeSelector: {}

## Ingress configuration
##
ingress:
  enabled: false
  className: ""
  annotations: {}
  ## Hosts configuration
  ##
  hosts:
    - host
  ## TLS configuration
  ##
  tls: []

## Secret configuration (for manually created secret)
##
secret:
  annotations: {}

## PostgreSQL Chart Configuration
## ref: https://github.com/bitnami/charts/blob/master/bitnami/postgresql/values.yaml
##
postgresql:
  ## Deploy PostgreSQL container(s)
  ##
  enabled: false
  image:
    repository: bitnamilegacy/postgresql
    tag: 16
  ## Authentication parameters
  ##
  auth:
    username: ilum
    password: CHANGEMEPLEASE
    database: marquez
    existingSecret: ""
